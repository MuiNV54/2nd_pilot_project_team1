<li><%= link_to "Friends", user_friendships_path(@user) %>(<%= @user.friendships.count %>)</li>
<li><%= link_to "View profile", profile_user_path(@user) %></li> 
<%= link_to "Albums", user_albums_path(@user) %>
<% if @user.albums.count > 0 %>
  (<%= @user.albums.count %>)</br>
  <% end %>
<% if current_user?(@user) %>
  <%= link_to "Create group", new_user_group_path(current_user) %> 
<% end %>
<div>
  <%= render "friend_form" if signed_in? %>
</div>
<% if current_user.friended?(@user) || current_user?(@user) %>
  <%= render "statuses/new" %>
<% end %>
<% @statuses.order_desc_created_at.each do |status| %>
  <% if status.shared_by?(@user) || status.concern?(@user) %>
    <% if current_user?(@user) || (current_user.friended?(@user) && status.friend?) || status.public? %>
      <% if status.create_by_friend? %>
        <div class="status-image">
          <% if status.user.avatar? %>
            <%= link_to image_tag(status.user.avatar.avatar), status.user %>
          <% else %>
            <%= link_to image_tag("https://fbcdn-profile-a.akamaihd.net/hprofile-ak-frc1/c178.0.604.604/s160x160/252231_1002029915278_1941483569_n.jpg", style:"width: 50px" ), status.user %>
          <% end %>
        </div>
  	    <%= link_to status.status_host.name, status.status_host %> to <%= link_to status.user.name, status.user %> <br/>
        <%= status.content.html_safe %>
      <% else %>
      <div class="status-image">
        <% if status.user.avatar? %>
          <%= link_to image_tag(status.user.avatar.avatar), status.user %>
        <% else %>
          <%= link_to image_tag("https://fbcdn-profile-a.akamaihd.net/hprofile-ak-frc1/c178.0.604.604/s160x160/252231_1002029915278_1941483569_n.jpg", style:"width: 50px" ), status.user %>
        <% end %>
      </div>
      <div class="status-content-wrap">
        <div class="name">          
          <%= link_to status.user.name, status.user %> </br>
        </div>
        <div class="status-content">
          <%= status.content.html_safe %>
        </div>
      </div>
      <% end %>
      <div class="status-meta" >
        <% if current_user.id == status.host_id && current_user?(@user) %>
          <li class="dropdown">
            <a href="#" data-toggle="dropdown" class="dropdown-toggle">permission<b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><%= link_to "public", user_status_path(@user, status, flag: "public"), method: :patch %></li>
              <li><%= link_to "friend", user_status_path(@user, status, flag: "friend"), method: :patch %></li>
              <li><%= link_to "private", user_status_path(@user, status, flag: "private"), method: :patch %></li>
            </ul>
          </li>
        <% end %>
        <%= time_ago_in_words status.created_at %> ago
        <a onclick= "like_or_unlike_status(<%= current_user.id %>,<%= status.id %>, this)">
          <% if status.liked? current_user %>
            Unlike
          <% else %>
            Like
          <% end %>
         </a>
        <span class="num"><%= status.like_statuses.count if status.like_statuses.count > 0  %></span>
        <%= link_to "share", user_status_shares_path(current_user, status), method: :post, confirm: "Do you want share this status in your wall?" %> 
        <%= status.share_by_users.count if status.share_by_users.count > 0 %>
        <% if status.shared_by?(current_user) && current_user?(@user) %>
          <%= link_to "delete", user_status_share_path(current_user, status, current_user.shares.shared(status.id).first), method: :delete %> 
        <% end %>
        <% if status.user_id == current_user.id %>
            <%= link_to "edit", "#", class: "non-redirect edit_status_btn" %>        
            <%= link_to "delete", user_status_path(@user, status), method: :delete, confirm: "Are you sure?" %>
        <% end %>
        <div class="edit_status_wrap" style="display: none" >
          <%= form_for [current_user, status] do |f| %>
            <%= f.text_area :content, class:"ckeditor" %>
            <%= f.submit "Edit status" %>
          <% end %>
        </div>        
      </div>
      <div class="status-comments">
        <% status.comments.each do |comment| %>
          <div class="status-comment">
            <div class="name">
              <% if comment.user.avatar? %>
                <%= link_to image_tag(comment.user.avatar.small_avatar), comment.user %>
              <% else %>
                <%= link_to image_tag("https://fbcdn-profile-a.akamaihd.net/hprofile-ak-frc1/c178.0.604.604/s160x160/252231_1002029915278_1941483569_n.jpg", style:"width: 32px" ), status.user %>
              <% end %>
              <%= link_to comment.user.name, comment.user %>
            </div>
            <%= comment.content %></br>
            <%= time_ago_in_words(comment.created_at) %> ago
            <a onclick= "like_or_unlike_comment(<%= current_user.id %>,<%= comment.id %>,this)" >
              <% if comment.liked_by? current_user %>
                Unlike
              <% else %>
                Like
              <% end %>
            </a>
            <span class="num"><%= comment.like_comments.count if comment.like_comments.count > 0  %></span>
            <% if status.user_id == current_user.id || comment.user_id == current_user.id %>
              <%= link_to "edit", "#", class: "non-redirect edit_comment_btn" %>
              <%= link_to "delete", user_status_comment_path(@user, status, comment), method: :delete, confirm: "Are you sure?" %> 
            <% end %>
          </div>
          <div class="edit_comment_wrap" style="display: none" >
            <%= form_for [current_user, status, comment] do |f| %>
              <%= f.text_area :content %>
              <%= f.submit "Edit comment" %>
            <% end %>
          </div>
        <% end %>
        <%= form_for [current_user, status, @comment] do |f|%>
          <div class="comment">
            <%= f.text_area :content, placeholder:"Write comment...", class: "comment_status", onkeyup:"textAreaAdjust(this)" %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% end %>
<script type="text/javascript">
  function like_or_unlike_status(user_id, status_id,btn){
    $.ajax({
      type: "GET",
      url: "/like_statuses/like_or_unlike",
      data: {user_id: user_id,status_id: status_id},
      error: function(data){
      },
      success: function(data){
        btn.innerText = data["message"];
        btn.nextElementSibling.innerText = data["num"];
      }
    })
  }
</script>

<script type="text/javascript">
  function like_or_unlike_comment(user_id, comment_id, btn){
    $.ajax({
      type: "GET",
      url: "/like_comments/like_or_unlike",
      data: {user_id: user_id,comment_id:comment_id},
      error: function(data){
        alert("Something went wrong");
      },
      success: function(data){
        btn.innerText = data["message"];
        btn.nextElementSibling.innerText = data["number"];
      }
    })
  }
</script>
<script>
function textAreaAdjust(o) {
    o.style.height = "1px";
    o.style.height = (10+o.scrollHeight)+"px";
}
$(".comment_status").on("keydown", function(e){

  if(e.keyCode ==13)
  {
    // $(".new_comment").submit();
  var form = this.parentNode.parentNode;
  $(form).submit();
  }
});

$("a.non-redirect").click(function(event){
    event.preventDefault();
});

$('.edit_status_btn').click(function() {
  $(this).parent().hide();
  $(this).parent().next('.edit_status_wrap').show();
});

$('.edit_comment_btn').click(function() {
  $(this).parent().hide();
  $(this).parent().next('.edit_comment_wrap').show();
});
</script>