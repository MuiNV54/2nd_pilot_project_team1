<li><%= link_to "Friendships", user_friendships_path(@user) %>(<%= @user.friendships.count %>)</li>
<li><%= link_to "View profile", profile_user_path(@user) %></li>
<%= link_to "create group", new_user_group_path(current_user) %> 
<div>
  <%= render "friend_form" if signed_in? %>
</div>
<% if current_user.friended?(@user) || current_user?(@user) %>
  <%= render "statuses/new" %>
<% end %>
<div class="user_profile">
  <%= render "shared/extand_profile" %>
</div>
<% @statuses.order_desc_created_at.each do |status| %>
  <% if status.shared_by?(@user) || status.concern?(@user) %>
    <% if current_user?(@user) || (current_user.friended?(@user) && status.friend?) || status.public? %>
      <% if status.create_by_friend? %>
  	    <%= link_to status.status_host.name, status.status_host %> to <%= link_to status.user.name, status.user %>
      <% else %>
        <%= link_to status.user.name, status.user %>
      <% end %>
      <div class="status_content" >
    	  <%= status.content.html_safe %></br>
        <% if current_user.id == status.host_id && current_user?(@user) %>
          <li class="dropdown">
            <a href="#" data-toggle="dropdown" class="dropdown-toggle">permission<b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><%= link_to "public", user_status_path(@user, status, flag: "public"), method: :patch %></li>
              <li><%= link_to "friend", user_status_path(@user, status, flag: "friend"), method: :patch %></li>
              <li><%= link_to "private", user_status_path(@user, status, flag: "private"), method: :patch %></li>
            </ul>
          </li>
        <% end %>
        <%= time_ago_in_words status.created_at %> ago
        <a onclick= "like_or_unlike_status(<%= current_user.id %>,<%= status.id %>, this)">
          <% if status.liked? current_user %>
            Unlike
          <% else %>
            Like
          <% end %>
        </a>
        <span class="num"><%= status.like_statuses.count if status.like_statuses.count > 0  %></span>
        <%= link_to "share", user_status_shares_path(current_user, status), method: :post, confirm: "Do you want share this status in your wall?" %> 
        <%= status.share_by_users.count if status.share_by_users.count > 0 %>
        <% if status.shared_by?(current_user) && current_user?(@user) %>
          <%= link_to "delete", user_status_share_path(current_user, status, current_user.shares.shared(status.id).first), method: :delete %> 
        <% end %>
        <% if status.user_id == current_user.id %>
            <%= link_to "edit", "#", class: "non-redirect edit_status_btn" %>        
            <%= link_to "delete", user_status_path(@user, status), method: :delete, confirm: "Are you sure?" %>
        <% end %>
      </div>
      <div class="edit_status_wrap" style="display: none" >
        <%= form_for [current_user, status] do |f| %>
          <%= f.text_area :content, class:"ckeditor" %>
          <%= f.submit "Edit status" %>
          <%= link_to "Cancel", :back %>
        <% end %>
      </div>
      <div class="status_comments">
        <% status.comments.each do |comment| %>
          <div class="status_comment">
            <%= link_to comment.user.name, comment.user %>
            <%= comment.content %></br>
            <%= time_ago_in_words(comment.created_at) %> ago
            <a onclick= "like_or_unlike_comment(<%= current_user.id %>,<%= comment.id %>,this)">
              <% if comment.liked_by? current_user %>
                Unlike
              <% else %>
                Like
              <% end %>
            </a>
            <span class="num"><%= comment.like_comments.count if comment.like_comments.count > 0  %></span>
            <% if status.user_id == current_user.id || comment.user_id == current_user.id %>
              <%= link_to "edit", "#", class: "non-redirect edit_comment_btn" %>
              <%= link_to "delete", user_status_comment_path(@user, status, comment), method: :delete, confirm: "Are you sure?" %> 
            <% end %>
          </div>
          <div class="edit_comment_wrap" style="display: none" >
            <%= form_for [current_user, status, comment] do |f| %>
              <%= f.text_area :content %>
              <%= f.submit "Edit comment" %>
            <% end %>
          </div>
        <% end %>
        <%= form_for [current_user, status, @comment] do |f|%>
          <div class="comment">
            <%= f.text_area :content, placeholder:"Write comment...", class: "comment_status", onkeyup:"textAreaAdjust(this)" %>
            <%= f.submit "Post" %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% end %>
<script type="text/javascript">
  function like_or_unlike_status(user_id, status_id,btn){
    $.ajax({
      type: "GET",
      url: "/like_statuses/like_or_unlike",
      data: {user_id: user_id,status_id: status_id},
      error: function(data){
      },
      success: function(data){
        btn.innerText = data["message"];
        btn.nextElementSibling.innerText = data["num"];
      }
    })
  }
</script>

<script type="text/javascript">
  function like_or_unlike_comment(user_id, comment_id, btn){
    $.ajax({
      type: "GET",
      url: "/like_comments/like_or_unlike",
      data: {user_id: user_id,comment_id:comment_id},
      error: function(data){
        alert("Something went wrong");
      },
      success: function(data){
        btn.innerText = data["message"];
        btn.nextElementSibling.innerText = data["number"];
      }
    })
  }
</script>
<script>
function textAreaAdjust(o) {
    o.style.height = "1px";
    o.style.height = (10+o.scrollHeight)+"px";
}

$("a.non-redirect").click(function(event){
    event.preventDefault();
});

$('.edit_status_btn').click(function() {
  $(this).parent().hide();
  $(this).parent().next('.edit_status_wrap').show();
});

$('.edit_comment_btn').click(function() {
  $(this).parent().hide();
  $(this).parent().next('.edit_comment_wrap').show();
});
</script>